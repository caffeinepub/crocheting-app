{
  "kind": "build_request",
  "title": "Fix Admin navigation link visibility after Internet Identity login",
  "projectName": "Crochet Studio",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-27",
      "text": "Add console.log statements in the Navigation component to debug the isAdmin state, identity state, and re-render behavior when authentication changes",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-no"
        ],
        "quotes": [
          "No"
        ]
      },
      "acceptanceCriteria": [
        "Console logs display current identity state in Navigation component",
        "Console logs display isAdmin query result and loading state",
        "Console logs trigger on component mount and when identity changes",
        "Logs help identify whether the issue is with the query not running, query returning wrong value, or component not re-rendering"
      ]
    },
    {
      "id": "REQ-28",
      "text": "Ensure the useIsCallerAdmin query in Navigation component is enabled and runs immediately after authentication state changes from anonymous to authenticated",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-no"
        ],
        "quotes": [
          "No"
        ]
      },
      "acceptanceCriteria": [
        "useIsCallerAdmin query executes automatically when identity state updates",
        "Query is not disabled or blocked by stale actor instance",
        "Navigation component has access to updated actor from useActor hook",
        "Query refetches when actor instance changes"
      ]
    },
    {
      "id": "REQ-29",
      "text": "Verify that the backend isCallerAdmin method in main.mo correctly returns true for the authenticated principal and that the method is being called with the correct identity",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-user-no"
        ],
        "quotes": [
          "No"
        ]
      },
      "acceptanceCriteria": [
        "isCallerAdmin method logs the caller principal for debugging",
        "Method returns true when called by an authenticated user",
        "Admin principals list includes the test user's principal",
        "Method response is correctly serialized and returned to frontend"
      ]
    },
    {
      "id": "REQ-30",
      "text": "Add explicit dependency on identity state in the Navigation component to force re-render when authentication status changes from logged out to logged in",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-no"
        ],
        "quotes": [
          "No"
        ]
      },
      "acceptanceCriteria": [
        "Navigation component uses identity from useInternetIdentity hook as a dependency",
        "Component re-renders when identity changes from null to defined",
        "isAdmin check runs with fresh data after authentication",
        "Admin link appears in navigation menu after successful login"
      ]
    }
  ],
  "constraints": [
    "Do not modify the single-actor architecture in backend/main.mo",
    "Do not edit immutable paths: frontend/src/hooks/useInternetIdentity.ts, frontend/src/hooks/useActor.ts, frontend/src/main.tsx, frontend/src/components/ui"
  ],
  "nonGoals": [
    "Adding new admin features beyond fixing the navigation link visibility",
    "Changing the authentication mechanism from Internet Identity",
    "Modifying the UI design or styling of the navigation component",
    "Adding new routes or pages"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}