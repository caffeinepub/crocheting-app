{
  "kind": "build_request",
  "title": "Fix Navigation component to properly detect authentication state changes and display Admin link",
  "projectName": "Crochet Craft Hub",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-31",
      "text": "Update the Navigation component at frontend/src/components/Navigation.tsx to add useEffect hooks that explicitly watch for changes in the identity state from useInternetIdentity and trigger the useIsCallerAdmin query to refetch when authentication status changes from logged out to logged in",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "Go ahead"
        ]
      },
      "acceptanceCriteria": [
        "Navigation component includes a useEffect that depends on identity state from useInternetIdentity",
        "When identity changes from null/anonymous to authenticated, the useIsCallerAdmin query is triggered to refetch",
        "The Admin link appears in the navigation bar immediately after successful Internet Identity login for admin users",
        "Console logs confirm the identity state change is detected and the admin check runs"
      ]
    },
    {
      "id": "REQ-32",
      "text": "Ensure the useIsCallerAdmin query in the Navigation component is properly enabled and configured to run immediately when the identity state becomes authenticated, using the enabled option based on identity presence",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "Go ahead"
        ]
      },
      "acceptanceCriteria": [
        "useIsCallerAdmin query has an enabled option that returns true only when identity is authenticated",
        "Query automatically runs when enabled state changes from false to true",
        "Query does not attempt to run when user is not authenticated",
        "Admin link visibility updates immediately when query returns successful result"
      ]
    },
    {
      "id": "REQ-33",
      "text": "Add refetch mechanism in Navigation component that manually triggers the useIsCallerAdmin query refetch when the actor instance changes or identity updates, ensuring the admin status check runs with the newly authenticated identity",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "Go ahead"
        ]
      },
      "acceptanceCriteria": [
        "Navigation component accesses the refetch function from the useIsCallerAdmin query",
        "Component triggers refetch when identity transitions from unauthenticated to authenticated",
        "Admin link appears in navigation within 1-2 seconds after successful login",
        "No race conditions occur where the query runs with stale or anonymous identity"
      ]
    }
  ],
  "constraints": [
    "Do not modify the useInternetIdentity hook implementation at frontend/src/hooks/useInternetIdentity.ts",
    "Do not modify the useActor hook implementation at frontend/src/hooks/useActor.ts",
    "Maintain the existing Navigation component structure and styling",
    "Preserve all existing navigation links and mobile menu functionality"
  ],
  "nonGoals": [
    "Changing the backend isCallerAdmin implementation",
    "Modifying the authentication flow or Internet Identity integration",
    "Altering the admin page access control logic",
    "Adding new navigation links or UI elements beyond the existing Admin link"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}